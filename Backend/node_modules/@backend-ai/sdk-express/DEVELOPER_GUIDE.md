# Backend AI Express SDK - Developer Guide

**Official integration guide for Express.js developers**

---

## ðŸ“‹ What You Need

Before starting, get these from your **Backend AI administrator:**

| Item | Example | Where to Get |
|------|---------|--------------|
| **Tenant ID** | `tenant_yourcompany` | From Backend AI admin |
| **Core URL** | `backend-ai.yourcompany.com:50051` | From Backend AI admin |
| **Gemini API Key** | `AIzaSy...` | [Get it here](https://makersuite.google.com/app/apikey) |

**System requirements:**
- Express.js v4.x or v5.x
- Node.js 18+

---

## ðŸš€ Quick Integration (5 minutes)

### Step 1: Install

```bash
npm install @backend-ai/sdk-express
```

### Step 2: Configure

Create `.env` in your project root:

```bash
# Your Gemini API key
GEMINI_API_KEY=your_gemini_api_key_here

# Backend AI Core URL (from admin)
CORE_URL=backend-ai.yourcompany.com:50051
```

### Step 3: Add to Your App

```javascript
const express = require('express');
const { BackendAI } = require('@backend-ai/sdk-express');
require('dotenv').config();

const app = express();
app.use(express.json());

// ========================================
// YOUR EXISTING ROUTES (don't change!)
// ========================================
app.get('/products', (req, res) => { /* ... */ });
app.post('/orders', (req, res) => { /* ... */ });
// ... all your other routes

// ========================================
// ADD SDK INITIALIZATION
// ========================================
(async () => {
  await BackendAI.init(app, {
    // PROVIDED BY ADMIN:
    tenantId: 'YOUR_TENANT_ID',           // Get from admin
    coreUrl: process.env.CORE_URL,        // From .env
    
    // CHOOSE YOURSELF:
    adapterId: 'my-backend-api',          // Unique name for your app
    
    // OPTIONAL:
    verbose: true,                        // Show detailed logs (recommended for first time)
  });

  // Start your server
  const PORT = process.env.PORT || 3000;
  app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
  });
})();
```

### Step 4: Run

```bash
npm start
```

**You should see:**
```
âœ… Registered X tools with Core
ðŸ§© SDK Executor running on port 6000
Server running on port 3000
```

**âœ… Done!** Your APIs are now AI-accessible.

---

## âš™ï¸ Configuration Reference

```javascript
BackendAI.init(app, {
  // ============ REQUIRED ============
  
  tenantId: 'YOUR_TENANT_ID',        // From Backend AI admin
  coreUrl: 'localhost:50051',        // From Backend AI admin  
  adapterId: 'my-app-name',          // Choose a unique identifier
  
  // ============ OPTIONAL ============
  
  executorPort: 6000,                // gRPC port (default: 6000)
  verbose: false,                    // Detailed logging (default: false)
  geminiApiKey: process.env.GEMINI_API_KEY,  // Uses env var by default
  geminiModel: 'gemini-2.5-flash',   // AI model (default: gemini-2.5-flash)
})
```

---

## ðŸ” What the SDK Does

1. **Discovers your routes** - Scans your Express app automatically
2. **Generates AI schemas** - Uses Gemini to understand your APIs
3. **Registers with Core** - Sends tool definitions to Backend AI
4. **Starts executor** - Runs a gRPC server (port 6000) for tool execution

**Important:** Your existing APIs continue working normally via HTTP. The SDK just makes them AI-accessible.

---

## âœ… Verification

After running your app, check for:

- âœ… Routes discovered: `ðŸ” Discovered X routes`
- âœ… Schemas generated: `âœ… Generated X tool definitions`
- âœ… Core connected: `âœ… Connected to Core at...`
- âœ… Tools registered: `âœ… Registered X tools with Core`
- âœ… Executor running: `ðŸ§© SDK Executor running on port 6000`

---

## ðŸ› Troubleshooting

### âŒ "No routes discovered"

**Problem:** Routes defined after `BackendAI.init()`

**Fix:** Call `BackendAI.init()` **AFTER** all route definitions:

```javascript
// âœ… CORRECT
app.get('/users', handler);
app.post('/orders', handler);
BackendAI.init(app, options);  // After routes

// âŒ WRONG
BackendAI.init(app, options);
app.get('/users', handler);  // Too late - not discovered
```

---

### âŒ "Failed to connect to Core"

**Problem:** Core service unreachable

**Check:**
1. Core URL is correct in `.env`
2. Core service is running
3. Network allows connection to Core port
4. Firewall not blocking port 50051

**Test connection:**
```bash
telnet backend-ai.yourcompany.com 50051
```

---

### âŒ "Port 6000 already in use"

**Problem:** Another service using port 6000

**Fix:** Use a different executor port:

```javascript
BackendAI.init(app, {
  executorPort: 6001,  // Use different port
  // ...
})
```

---

### âŒ "GEMINI_API_KEY not set"

**Problem:** Missing Gemini API key

**Impact:** SDK will use fallback (generic tool names like "POST /orders" instead of "Create Order")

**Fix:** Add to `.env`:
```bash
GEMINI_API_KEY=your_key_here
```

Get key from: https://makersuite.google.com/app/apikey

---

## ðŸ”’ Security Notes

1. **Executor port (6000):**
   - Should **NOT** be publicly accessible
   - Only Backend AI Core needs access
   - Use firewall rules to restrict access

2. **Authentication:**
   - Your existing auth middleware continues to work for HTTP requests
   - Tool execution (via AI) bypasses Express middleware
   - Core service handles authorization at the tool level

3. **Production deployment:**
   - Use environment-specific Core URLs
   - Protect your Gemini API key
   - Monitor executor port access

---

## ðŸ“ Best Practices

### 1. Use Named Functions

Helps Gemini generate better tool descriptions:

```javascript
// âœ… GOOD
app.post('/orders', createOrder);

function createOrder(req, res) {
  const { userId, items } = req.body;
  // Creates a new customer order
}

// âš ï¸ OK, but less descriptive
app.post('/orders', (req, res) => { /* ... */ });
```

### 2. Add Code Comments

Gemini reads your comments:

```javascript
// Creates a new customer order and processes payment
app.post('/orders', (req, res) => {
  // ...
});
```

### 3. Use Standard REST Patterns

```javascript
GET    /resources       // List
GET    /resources/:id   // Get one
POST   /resources       // Create
PUT    /resources/:id   // Update
DELETE /resources/:id   // Delete
```

### 4. Enable Verbose Logging (Development)

```javascript
verbose: process.env.NODE_ENV !== 'production'
```

### 5. Graceful Shutdown

```javascript
process.on('SIGTERM', async () => {
  await BackendAI.shutdown();
  process.exit(0);
});
```

---

## ðŸ”„ Making Changes

### Adding New Routes

Just restart your server - SDK auto-discovers on startup:

```javascript
// Add new route
app.get('/newroute', handler);

// Restart
npm start  // SDK will discover new route
```

### Removing Routes

Remove the route and restart - SDK will update registration.

### Modifying Route Logic

Route handler changes are picked up automatically - no restart needed for execution, but schemas won't update until restart.

---

## ðŸ“Š Monitoring

### Check Registered Tools

The SDK logs all registered tools on startup when `verbose: true`:

```
ðŸ” Discovered 12 Express routes:
   GET /products
   POST /products
   GET /products/:id
   ...
âœ… Registered 12 tools with Core
```

### Check Executor Status

Look for:
```
ðŸ§© SDK Executor running on port 6000
```

### Test Your APIs Still Work

Your existing APIs are unchanged:

```bash
# Test via HTTP (as before)
curl http://localhost:3000/products
```

---

## â“ FAQ

**Q: Do I need to modify my existing routes?**  
A: No! The SDK works with your code as-is.

**Q: Will this affect my API performance?**  
A: No. HTTP requests work exactly as before. Only AI tool calls go through the SDK executor.

**Q: Can I use this with TypeScript?**  
A: Yes! The SDK includes TypeScript definitions.

**Q: What if Core service goes down?**  
A: Your Express app continues running normally. Tool registration fails but HTTP APIs work fine.

**Q: How much does Gemini cost?**  
A: Check current pricing at https://ai.google.dev/pricing - typically very low cost for schema generation.

**Q: Can I disable auto-discovery?**  
A: Yes, set `autoDiscover: false` in options, but you'll need to manually register tools.

---

## ðŸ“ž Support

If you encounter issues:

1. **Check logs** - Enable `verbose: true`
2. **Verify prerequisites** - Tenant ID, Core URL, API key
3. **Test connectivity** - Ensure Core is reachable
4. **Contact admin** - Your Backend AI administrator

---

## ðŸ“¦ Complete Example

```javascript
// server.js
const express = require('express');
const { BackendAI } = require('@backend-ai/sdk-express');
require('dotenv').config();

const app = express();
app.use(express.json());

// Products API
app.get('/products', (req, res) => {
  res.json({ products: [] });
});

app.get('/products/:id', (req, res) => {
  const { id } = req.params;
  res.json({ id, name: 'Product', price: 99.99 });
});

app.post('/products', (req, res) => {
  const { name, price } = req.body;
  res.status(201).json({ id: '123', name, price });
});

// Orders API
app.post('/orders', (req, res) => {
  const { userId, items } = req.body;
  res.status(201).json({
    orderId: '42',
    userId,
    items,
    status: 'created'
  });
});

// Initialize SDK
(async () => {
  try {
    await BackendAI.init(app, {
      tenantId: process.env.TENANT_ID,
      adapterId: 'ecommerce-api',
      coreUrl: process.env.CORE_URL,
      verbose: true,
    });

    const PORT = process.env.PORT || 3000;
    app.listen(PORT, () => {
      console.log(`ðŸš€ Server running on http://localhost:${PORT}`);
    });
  } catch (error) {
    console.error('Failed to initialize SDK:', error);
    process.exit(1);
  }
})();

// Graceful shutdown
process.on('SIGTERM', async () => {
  await BackendAI.shutdown();
  process.exit(0);
});
```

```.env
TENANT_ID=YOUR_TENANT_ID
CORE_URL=backend-ai.yourcompany.com:50051
GEMINI_API_KEY=your_gemini_api_key_here
PORT=3000
```

---

**That's it!** You're ready to go. Integration takes ~5 minutes. ðŸŽ‰

For questions, contact your Backend AI administrator.
