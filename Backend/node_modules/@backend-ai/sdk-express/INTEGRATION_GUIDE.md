# Backend AI SDK - Developer Integration Guide

**Version:** 1.0.0  
**For:** Express.js Backend Developers  
**Time to Integrate:** ~15 minutes

---

## ðŸ“‹ What is This?

The **Backend AI SDK** automatically discovers all your Express.js API routes and registers them as tools that AI agents can execute. This enables your backend to be seamlessly integrated with AI-powered applications.

**No code changes to your existing APIs required!**

---

## âœ… Prerequisites

Before you begin, ensure you have:

- âœ… An existing Express.js application (v4.x or v5.x)
- âœ… Node.js 18+ installed
- âœ… Access to Backend AI Core service (URL and port)
- âœ… Gemini API key ([Get one here](https://makersuite.google.com/app/apikey))

---

## ðŸš€ Quick Start (5 Steps)

### Step 1: Install the SDK

```bash
npm install @backend-ai/sdk-express
```

### Step 2: Create Environment File

Create a `.env` file in your project root:

```bash
GEMINI_API_KEY=your_gemini_api_key_here
CORE_URL=localhost:50051
```

### Step 3: Import the SDK

Add this to your main Express app file (usually `app.js`, `server.js`, or `index.js`):

```javascript
const { BackendAI } = require('@backend-ai/sdk-express');
require('dotenv').config();
```

### Step 4: Initialize the SDK

Add this **AFTER** you've defined all your routes, but **BEFORE** starting your server:

```javascript
const express = require('express');
const { BackendAI } = require('@backend-ai/sdk-express');
require('dotenv').config();

const app = express();
app.use(express.json());

// ============================================
// YOUR EXISTING ROUTES (don't change these!)
// ============================================
app.get('/products', (req, res) => { /* ... */ });
app.post('/orders', (req, res) => { /* ... */ });
// ... all your other routes

// ============================================
// INITIALIZE SDK (add this)
// ============================================
(async () => {
  await BackendAI.init(app, {
    adapterId: 'my-company-backend',      // Choose a unique ID
    tenantId: 'tenant_001',               // Your tenant ID
    coreUrl: process.env.CORE_URL,        // From .env
    geminiApiKey: process.env.GEMINI_API_KEY,
    verbose: true,                         // See what's happening
  });

  // Start your server
  const PORT = process.env.PORT || 3000;
  app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
  });
})();
```

### Step 5: Run Your App

```bash
npm start
```

You should see:

```
ðŸš€ Initializing Backend AI SDK for Express...
ðŸ” Discovered 12 Express routes
ðŸ¤– Generating tool schemas using Gemini AI...
âœ… Generated 12 tool definitions
ðŸ“¡ Registering tools with Core...
âœ… Registered 12 tools with Core
ðŸ§© SDK Executor running on port 6000
âœ¨ Backend AI SDK initialized successfully!
Server running on port 3000
```

**That's it! You're done!** ðŸŽ‰

---

## âš™ï¸ Configuration Reference

| Parameter | Required | Default | Description |
|-----------|----------|---------|-------------|
| `adapterId` | âœ… Yes | - | Unique identifier for your backend (e.g., `'order-service'`, `'user-api'`) |
| `tenantId` | âœ… Yes | - | Your organization's tenant ID (provided by admin) |
| `coreUrl` | âœ… Yes | - | Backend AI Core service URL (e.g., `'localhost:50051'`) |
| `executorPort` | âŒ No | `6000` | Port for gRPC executor (must be available) |
| `geminiApiKey` | âŒ No | env var | Gemini API key (uses `GEMINI_API_KEY` if not provided) |
| `geminiModel` | âŒ No | `'gemini-1.5-flash'` | Gemini model to use |
| `autoDiscover` | âŒ No | `true` | Automatically discover routes |
| `persist` | âŒ No | `true` | Register tools with Core database |
| `verbose` | âŒ No | `false` | Enable detailed logging |

---

## ðŸ“ Complete Example

```javascript
// server.js
const express = require('express');
const { BackendAI } = require('@backend-ai/sdk-express');
require('dotenv').config();

const app = express();
app.use(express.json());

// ======================
// YOUR ROUTES
// ======================

// Products
app.get('/api/products', (req, res) => {
  res.json({ products: [] });
});

app.get('/api/products/:id', (req, res) => {
  const { id } = req.params;
  res.json({ id, name: 'Product', price: 99.99 });
});

app.post('/api/products', (req, res) => {
  const { name, price } = req.body;
  res.status(201).json({ 
    id: '123', 
    name, 
    price, 
    created: true 
  });
});

// Orders
app.post('/api/orders', (req, res) => {
  const { userId, items } = req.body;
  res.status(201).json({
    orderId: '42',
    userId,
    items,
    status: 'created'
  });
});

// ======================
// SDK INITIALIZATION
// ======================

(async () => {
  try {
    await BackendAI.init(app, {
      adapterId: 'ecommerce-api',
      tenantId: 'acme-corp',
      coreUrl: process.env.CORE_URL || 'localhost:50051',
      geminiApiKey: process.env.GEMINI_API_KEY,
      executorPort: 6000,
      verbose: true,
    });

    const PORT = process.env.PORT || 3000;
    app.listen(PORT, () => {
      console.log(`ðŸš€ Server running on http://localhost:${PORT}`);
    });
  } catch (error) {
    console.error('Failed to initialize SDK:', error);
    process.exit(1);
  }
})();

// Graceful shutdown
process.on('SIGTERM', async () => {
  console.log('Shutting down gracefully...');
  await BackendAI.shutdown();
  process.exit(0);
});
```

---

## ðŸ§ª Testing Your Integration

### 1. Check SDK Initialization

When you start your server, you should see:

```bash
âœ… Connected to Core
ðŸ” Discovered 4 routes
âœ… Generated 4 tool definitions
âœ… Registered 4 tools with Core
ðŸ§© SDK Executor running on port 6000
âœ¨ Backend AI SDK initialized successfully!
```

### 2. Verify Your Routes Still Work

Test your existing APIs:

```bash
curl http://localhost:3000/api/products
curl -X POST http://localhost:3000/api/orders \
  -H "Content-Type: application/json" \
  -d '{"userId": "123", "items": []}'
```

They should work exactly as before!

### 3. Check Port Availability

Ensure port **6000** is available (or configure a different `executorPort`):

```bash
lsof -i :6000
```

If port is in use, change it in your config:

```javascript
await BackendAI.init(app, {
  // ...
  executorPort: 6001, // Use a different port
});
```

---

## ðŸ”’ Authentication & Security

### Important Notes:

1. **SDK doesn't modify your auth** - Your existing authentication/authorization continues to work for direct HTTP requests

2. **Tool execution bypasses Express middleware** - When AI agents call your tools via the SDK, the executor runs handlers directly with mocked `req`/`res` objects, bypassing middleware like auth guards

3. **Secure your Core connection** - In production, use secure gRPC credentials:

```javascript
// Production setup (TBD - update when Core supports TLS)
coreUrl: 'backend-ai-core.example.com:50051'
```

4. **Protect executor port** - The gRPC executor port (default 6000) should not be exposed to the public internet. Use firewall rules to allow only Core service access.

---

## â“ Troubleshooting

### Problem: "No routes discovered"

**Solution:** Make sure you define routes **before** calling `BackendAI.init()`:

```javascript
// âœ… CORRECT
app.get('/users', handler);
BackendAI.init(app, options);

// âŒ WRONG
BackendAI.init(app, options);
app.get('/users', handler); // Won't be discovered!
```

---

### Problem: "Failed to connect to Core"

**Possible causes:**

1. Core service not running
2. Wrong `coreUrl` in config
3. Firewall blocking connection

**Solution:** Verify Core service is running:

```bash
# Check if Core is accessible
telnet localhost 50051
```

---

### Problem: "GEMINI_API_KEY not set"

**Solution:** SDK will use fallback metadata, but for best results, add Gemini API key:

```bash
# .env
GEMINI_API_KEY=AIzaSy...
```

Without Gemini, tools will have generic names like "POST /orders" instead of semantic names like "Create New Order".

---

### Problem: "Port 6000 already in use"

**Solution:** Change the executor port:

```javascript
await BackendAI.init(app, {
  // ...
  executorPort: 6001,
});
```

---

### Problem: "SDK initialization timeout"

**Possible causes:**

1. Too many routes (schema generation takes time)
2. Gemini API rate limits
3. Network issues

**Solution:** Enable verbose logging to see where it's stuck:

```javascript
await BackendAI.init(app, {
  // ...
  verbose: true, // See detailed logs
});
```

---

## ðŸ“Š What Gets Sent to Core?

For each route, the SDK sends:

```json
{
  "tool_id": "express.api.products.id.get",
  "name": "Get Product Details",
  "description": "Fetches detailed product information by ID",
  "input_schema": {
    "type": "object",
    "properties": {
      "id": {
        "type": "string",
        "description": "Product identifier"
      }
    },
    "required": ["id"]
  },
  "adapter": {
    "framework": "express",
    "method": "GET",
    "path": "/api/products/:id"
  }
}
```

**No sensitive data** (secrets, credentials, business logic) is sentâ€”only API metadata.

---

## ðŸŽ¯ Best Practices

### 1. Use Descriptive Route Handlers

Instead of:

```javascript
app.post('/orders', (req, res) => { /* ... */ });
```

Use named functions (helps Gemini generate better descriptions):

```javascript
app.post('/orders', createOrder);

function createOrder(req, res) {
  const { userId, items } = req.body;
  // ... create order logic
}
```

### 2. Add Comments

Gemini reads your code! Add comments to help:

```javascript
// Creates a new customer order and processes payment
app.post('/orders', (req, res) => {
  // ...
});
```

### 3. Use Standard REST Patterns

SDK works best with RESTful APIs:

- `GET /resources` - List
- `GET /resources/:id` - Get one
- `POST /resources` - Create
- `PUT /resources/:id` - Update
- `DELETE /resources/:id` - Delete

### 4. Enable Verbose Logging (Development)

```javascript
verbose: process.env.NODE_ENV !== 'production'
```

### 5. Graceful Shutdown

```javascript
process.on('SIGTERM', async () => {
  await BackendAI.shutdown();
  process.exit(0);
});
```

---

## ðŸ“ž Support & Questions

- **Documentation:** See `packages/sdk-express/README.md`
- **Example App:** See `packages/sdk-express/example/`
- **Issues:** Contact your Backend AI administrator

---

## ðŸ”„ Updating Your Integration

When you add/modify/remove routes:

1. **Restart your server** - SDK auto-discovers routes on startup
2. **New schemas are generated** - Gemini analyzes new routes
3. **Core is updated** - Tools are re-registered automatically

No manual updates needed! ðŸŽ‰

---

## âœ… Integration Checklist

Before going to production:

- [ ] SDK installed via npm
- [ ] `.env` file configured with `GEMINI_API_KEY` and `CORE_URL`
- [ ] `BackendAI.init()` called after routes, before `app.listen()`
- [ ] Tested: Routes still work via HTTP
- [ ] Tested: SDK initialization succeeds (check logs)
- [ ] Executor port (6000) is not exposed to public internet
- [ ] Graceful shutdown handler added
- [ ] Verbose logging disabled in production
- [ ] Confirmed with admin that tools are registered in Core

---

**Happy integrating! ðŸš€**

*If you have any questions, reach out to your Backend AI team.*
